<!--pages/charm/pages/publishTaskForm/publishTaskForm.wxml-->
<text>pages/charm/pages/publishTaskForm/publishTaskForm.wxml</text>
<cu-custom bgColor="bg-gradual-blue" isBack="{{true}}">
  <view slot="content">任务发布</view>
</cu-custom>
<view class="padding-lr-lg">

  <view class="cu-form-group">
    <view class="title"><text class="text-red">* </text>任务名称：</view>
    <input placeholder="请输入任务名称" bindinput="putData" data-key="taskName"></input>
  </view>
  <view class="cu-form-group">
    <view class="title">部门选择</view>
    <button class="cu-btn bg-green shadow round" bindtap="showModal" data-target="RadioModal">请选择</button>
  </view>

  <view class="cu-modal {{modalName=='RadioModal'?'show':''}}">
    <view class="cu-dialog" catchtap>
      <checkbox-group class="block" bindchange="deptSelect">
        <view class="cu-list menu text-left">
          <view class="cu-item" wx:for="{{deptList}}" wx:key="item">
            <label class="flex justify-between align-center flex-sub">
              <view class="flex-sub">{{item.tname}}</view>
              <checkbox class="round" value="{{item.tname}}"></checkbox>
            </label>
          </view>
        </view>
      </checkbox-group>
      <view class="action flex justify-around margin-tb-sm">
        <button class="cu-btn line-green text-green" bindtap="hideModal">取消</button>
        <button class="cu-btn bg-green margin-left" bindtap="determine">确定</button>
      </view>
    </view>

  </view>

  <view class="cu-form-group" style="border-top: 1rpx solid #eee;">
    <view class="title">任务发起时间</view>
    <picker mode="date" value="{{date}}" start="{{startDate}}" end="2220-01-01" bindchange="startDateChange">
      <view class="picker">
        {{startDate}}
      </view>
    </picker>
  </view>

  <view class="cu-form-group">
    <view class="title">截止时间</view>
    <picker mode="date" value="{{date}}" start="{{startDate}}" end="2220-01-01" bindchange="endDateChange">
      <view class="picker">
        {{endDate}}
      </view>
    </picker>
  </view>

  <view class="cu-form-group align-start">
    <view class="title"><text class="text-red">* </text>任务内容：</view>
    <textarea maxlength="-1" placeholder="请输入任务内容" bindinput="putData" data-key="taskInfo"></textarea>
  </view>

  <view class="cu-form-group padding-left-sm align-start" style="padding:30rpx 0 30rpx 30rpx;">
    <view class="title" style="margin:20rpx 0 0 0">任务内容录音：</view>
    <view bindtap="showVoice" class="cuIcon-rankfill bg-green radius margin-right padding-left"
      style="height:60rpx;flex:1;line-height:60rpx"> {{voiceLong}}{{voiceStatus}}</view>
    <view bindlongpress="startrecord" bindtouchend="endrecord" class="flex align-center" style="margin-left:auto ">
      <text class="cuIcon-voice round bg-green text-center" style="width:60rpx;height:60rpx;line-height:60rpx"></text>
      <text class="text-xs margin-left-xs">按住\n录制</text>
    </view>
  </view>


  <!-- 图片上传 -->
  <view class="cu-bar bg-white" style="border-top: 1rpx solid #eee;">
    <view class="action">
      图片上传
    </view>
    <view class="action">
      {{imgList.length}}/9
    </view>
  </view>
  <view class="cu-form-group">
    <view class="grid col-3 grid-square flex-sub">
      <view class="bg-img" wx:for="{{imgList}}" wx:key="{{index}}" bindtap="ViewImage" data-url="{{imgList[index]}}">
        <image src='{{imgList[index]}}' mode='aspectFill'></image>
        <view class="cu-tag bg-red" catchtap="DelImg" data-index="{{index}}">
          <text class="cuIcon-close"></text>
        </view>
      </view>
      <view class="solids" bindtap="ChooseImage" wx:if="{{imgList.length<9}}">
        <text class="cuIcon-cameraadd"></text>
      </view>
    </view>
  </view>

  <!-- 提交 -->
  <view class="padding flex flex-direction">
    <button bindtap="commitData" class="cu-btn bg-green margin-tb-sm lg">发布任务</button>
  </view>


</view>